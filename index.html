<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shadowrun Priorities Selector</title>
  <style>
    body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 2rem auto;
        max-width: 720px;
        line-height: 1.4;
        color: #222;
    }

    h1 {
        font-size: 1.6rem;
        margin-bottom: 1.5rem;
        text-align: center;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 1.5rem;
        background: #fdfdfd;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    th {
        background: #efefef;
        padding: 0.6rem;
        font-weight: bold;
        text-align: center;
        font-size: 0.95rem;
    }

    td {
        border-top: 1px solid #ddd;
        padding: 0.4rem 0.5rem;
        font-size: 0.95rem;
        text-align: left;
    }

    td select {
        width: 100%;
        padding: 0.3rem;
        font-size: 0.95rem;
    }

    button {
        display: block;
        margin: 1rem auto 1.5rem auto;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        font-weight: bold;
        background: #2e86ab;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s ease-in-out;
    }

    button:hover {
        background: #256d8c;
    }

    .output {
        border-left: 4px solid #2e86ab;
        background: #f0f7fb;
        padding: 1rem;
        font-size: 0.95rem;
        border-radius: 4px;
    }

    .attributes {
        background: #fefefe;
        padding: 1.5rem;
        border: 1px solid #ccc;
        border-radius: 6px;
        margin-top: 2rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .attributes h2 {
        text-align: center;
        font-size: 1.25rem;
        margin-bottom: 1rem;
        color: #2e86ab;
    }

    .attributes table {
        width: 100%;
        border-collapse: collapse;
    }

    .attributes th,
    .attributes td {
        padding: 0.5rem;
        text-align: center;
        border: 1px solid #ddd;
    }

    .attributes th {
        background-color: #e9f4f9;
        font-weight: bold;
    }

    .attributes td:first-child {
        font-weight: bold;
        text-align: left;
        padding-left: 1rem;
        background-color: #f9f9f9;
    }

    .attributes input[type="number"] {
        width: 60px;
        padding: 0.25rem;
        font-size: 0.95rem;
        text-align: center;
        border: 1px solid #bbb;
        border-radius: 4px;
    }

    .attributes td:last-child {
        font-weight: bold;
        color: #333;
    }

    body.dark-mode {
        background-color: #1a1a1a;
        color: #e0e0e0;
    }

    body.dark-mode .output {
        background-color: #222;
        border-left-color: #0ff;
    }

    body.dark-mode h1,
    body.dark-mode h2 {
        color: #ea00ff;
    }

    body.dark-mode h1 {
        text-shadow: 0 0 4px #ea00ff;
    }

    body.dark-mode table {
        background-color: #1f1f1f;
        color: #e0e0e0;
        box-shadow: 0 0 8px rgba(0, 255, 255, 0.1);
    }

    body.dark-mode th {
        background-color: #292929;
        color: #ea00ff;
    }

    body.dark-mode td:first-child {
        background-color: #262626;
        color: #f0f0f0;
    }

    body.dark-mode input[type="number"] {
        background-color: #333;
        color: #e0e0e0;
        border: 1px solid #555;
    }

    body.dark-mode button {
        background-color: #ea00ff;
        color: #111;
    }

    body.dark-mode button:hover {
        background-color: #8700d6;
    }

    /* Light mode total column */
    .attributes td:last-child {
        font-weight: bold;
        color: #222;
        background-color: #f5f5f5;
    }

    /* Dark mode total column */
    body.dark-mode .attributes td:last-child {
        color: #00ffcc;
        background-color: #1e1e1e;
        text-shadow: 0 0 4px #00ffcc;
    }



  </style>
</head>
<body>

  <h1>Shadowrun Sixth World Priority Selector</h1>
  <button id="theme-toggle" onclick="toggleDarkMode()">Toggle Dark Mode</button>
  <table>
    <thead>
      <tr>
        <th>Category</th>
        <th>Select Priority (Aâ€“E)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Metatype</td>
        <td>
          <select id="metatype-select">
            <option value="">-- Select --</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
          </select>
        </td>
      </tr>
      <tr>
        <td>Attributes</td>
        <td>
          <select id="attributes-select">
            <option value="">-- Select --</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
          </select>
        </td>
      </tr>
      <tr>
        <td>Skills</td>
        <td>
          <select id="skills-select">
            <option value="">-- Select --</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
          </select>
        </td>
      </tr>
      <tr>
        <td>Magic/Resonance</td>
        <td>
          <select id="magic-select">
            <option value="">-- Select --</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
          </select>
        </td>
      </tr>
      <tr>
        <td>Resources</td>
        <td>
          <select id="resources-select">
            <option value="">-- Select --</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
          </select>
        </td>
      </tr>
    </tbody>
  </table>

  <button onclick="updateOutput()">Update Summary</button>
  <button onclick="resetAll()">Reset All</button>

  <div class="output" id="output">
    <strong>Selection Summary:</strong><br>
    No selections made yet.
  </div>

  <div class="selections" id="selections">
    <h2>Selections</h2>
    <table>
        <thead>
            <tr>
                <th>Selection</th>
                <th>Selector</th>
            </tr>
        </thead>
        <tbody>
            <tr id="metatype-row" style="display: none;">
                <td>Choose Metatype</td>
                <td>
                    <select name="metatype-choice" id="metatype-choice">
                        <option value="">-- Select Metatype --</option>
                    </select>
                </td>
            </tr>
            <tr id="magic-type-row" style="display: none;">
                <td>Choose Magic Type</td>
                <td>
                    <select name="magic-user-choice" id="magic-user-choice">
                        <option value="">-- Select Magic Type --</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>
  </div>

  <div class="attributes" id="attributes">
    <h2>Attributes</h2>
    <table>
        <thead>
            <tr>
                <th>Attribute</th>
                <th>Base 1</th>
                <th>Points Added</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Body</td>
                <td>1</td>
                <td><input type="number" name="body-points" id="body-points" min="0" max="10"></td>
                <td id="body-total"></td>
            </tr>
            <tr>
                <td>Agility</td>
                <td>1</td>
                <td><input type="number" name="agility-points" id="agility-points" min="0" max="10"></td>
                <td id="agility-total"></td>
            </tr>
            <tr>
                <td>Reaction</td>
                <td>1</td>
                <td><input type="number" name="reaction-points" id="reaction-points" min="0" max="10"></td>
                <td id="reaction-total"></td>
            </tr>
            <tr>
                <td>Strength</td>
                <td>1</td>
                <td><input type="number" name="strength-points" id="strength-points" min="0" max="10"></td>
                <td id="strength-total"></td>
            </tr>
            <tr>
                <td>Willpower</td>
                <td>1</td>
                <td><input type="number" name="willpower-points" id="willpower-points" min="0" max="10"></td>
                <td id="willpower-total"></td>
            </tr>
            <tr>
                <td>Logic</td>
                <td>1</td>
                <td><input type="number" name="logic-points" id="logic-points" min="0" max="10"></td>
                <td id="logic-total"></td>
            </tr>
            <tr>
                <td>Intuition</td>
                <td>1</td>
                <td><input type="number" name="intuition-points" id="intuition-points" min="0" max="10"></td>
                <td id="intuition-total"></td>
            </tr>
            <tr>
                <td>Charisma</td>
                <td>1</td>
                <td><input type="number" name="charisma-points" id="charisma-points" min="0" max="10"></td>
                <td id="charisma-total"></td>
            </tr>
            <tr>
                <td>Edge</td>
                <td>1</td>
                <td><input type="number" name="edge-points" id="edge-points" min="0" max="10"></td>
                <td id="edge-total"></td>
            </tr>
        </tbody>
    </table>
  </div>

  <script>
    const selectors = [
        document.getElementById('metatype-select'),
        document.getElementById('attributes-select'),
        document.getElementById('magic-select'),
        document.getElementById('skills-select'),
        document.getElementById('resources-select')
    ];

    const attributeInputs = [
        document.getElementById('body-points'),
        document.getElementById('agility-points'),
        document.getElementById('reaction-points'),
        document.getElementById('strength-points'),
        document.getElementById('willpower-points'),
        document.getElementById('logic-points'),
        document.getElementById('intuition-points'),
        document.getElementById('charisma-points'),
        document.getElementById('edge-points')
    ];

    const attributeTotals = [
        document.getElementById('body-total'),
        document.getElementById('agility-total'),
        document.getElementById('reaction-total'),
        document.getElementById('strength-total'),
        document.getElementById('willpower-total'),
        document.getElementById('logic-total'),
        document.getElementById('intuition-total'),
        document.getElementById('charisma-total'),
        document.getElementById('edge-total')
    ];

    // Function to update dropdowns
    function updateDropdowns() {
        console.clear();
        console.log("Updating Dropdowns");

        // Gather current selections
        const selectedValues = selectors.map(sel => sel.value);
        console.log(selectedValues);

        // For each selector, reset all the options to enabled
        selectors.forEach((currentSel, idx) => {
            const currentValue =  currentSel.value;

            Array.from(currentSel.options).forEach(option => {
                if (option.value === "") return; // skip placeholder
                option.disabled = false; //reset all options
            });

            // Disable values already used in other selectors
            selectors.forEach((otherSel, otherIdx) => {
                if (idx === otherIdx) return; // skip self
                const usedValue = otherSel.value;
                if (usedValue) {
                    const optionToDisable = currentSel.querySelector(`option[value="${usedValue}"]`);
                    if (optionToDisable) {
                        optionToDisable.disabled = true;
                    }
                }
            });

            // Ensure the current selected value is still enabled
            const selectedOption = currentSel.querySelector(`option[value="${currentValue}"]`);
            if (selectedOption) {
                selectedOption.disabled = false;
            }
        });
    }

    // FUNCTIONS FOR ADDING OPTIONS
    function updateMetatypeOptions() {
        const priority = document.getElementById('metatype-select').value;
        const metatypeRow = document.getElementById('metatype-row');
        const metatypeSelect = document.getElementById('metatype-choice');

        // Hide row if no priorty is selected
        if (!priority || !priorityData.metatype[priority]) {
            metatypeRow.style.display = 'none';
            metatypeSelect.innerHTML = '<option value="">-- Select Metatype --</option>';
            return;
        }

        // show the row
        metatypeRow.style.display = '';

        // get options and rebuild dropdown
        const allowedTypes = priorityData.metatype[priority].options;

        // clear existing options
        metatypeSelect.innerHTML = '<option value="">-- Select Metatype --</option>';

        // Add new options
        allowedTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = type;
            metatypeSelect.appendChild(option);

        });
    }

    function updateMagicOptions() {
        const priority = document.getElementById('magic-select').value;
        const magicRow = document.getElementById('magic-type-row');
        const magicSelect = document.getElementById('magic-user-choice');

        if (!priority || !priorityData.magic[priority]) {
            magicRow.style.display = 'none';
            magicSelect.innerHTML = '<option value="">-- Select Magic Type --</option>';
            return;
        }

        magicRow.style.display = '';

        const types = Object.keys(priorityData.magic[priority]);
        magicSelect.innerHTML = '<option value="">-- Select Magic Type --</option>';

        types.forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = capitalize(type) + " - " + priorityData["magic"][priority][type];
            magicSelect.appendChild(option);
        });
    }

    // Function to update Attribute Totals
    function updateAttributeTotals() {
        attributeInputs.forEach((input, index) => {
            const added = parseInt(input.value, 10) || 0;
            attributeTotals[index].textContent = 1 + added;
        });
    }

    // RESET ALL LOGIC
    function resetAll() {
        // clear all priority selectors
        selectors.forEach(sel => {
            sel.value = "";
        });

        // clear choice selectors
        document.getElementById("metatype-choice").innerHTML = '<option value="">-- Select Metatype --</option>';
        document.getElementById("magic-user-choice").innerHTML = '<option value="">-- Select Magic Type --</option>';

        // hide sub-choice rows
        document.getElementById("metatype-row").style.display = "none";
        document.getElementById("magic-type-row").style.display = "none";

        // clear output box
        document.getElementById("output").innerHTML = "<strong>Selection Summary:</strong><br>No selections made yet.";

        // reset priority availability and summary
        updateDropdowns();
    }

    // Attach the listener and run once at page load
    selectors.forEach(sel => {
        sel.addEventListener('change', updateDropdowns);
    });

    // Attach Attributes Totals event listeners
    attributeInputs.forEach(input => {
        input.addEventListener('input', updateAttributeTotals);
    });

    // Priority Selection Display Values
    const priorityData = {
        metatype: {
            A: { adjustmentPoints: 13, options: ['Ork', 'Dwarf', 'Troll'] },
            B: { adjustmentPoints: 11, options: ['Elf', 'Ork', 'Dwarf', 'Troll'] },
            C: { adjustmentPoints: 9, options: ['Human', 'Elf', 'Ork', 'Dwarf', 'Troll'] },
            D: { adjustmentPoints: 4, options: ['Human', 'Elf', 'Ork', 'Dwarf', 'Troll'] },
            E: { adjustmentPoints: 1, options: ['Human', 'Elf', 'Ork', 'Dwarf', 'Troll'] },
        },
        attributes: {
            A: { points: 24 },
            B: { points: 16 },
            C: { points: 12 },
            D: { points: 8 },
            E: { points: 2 },
        },
        magic: {
            A: { full: 4, aspected: 5, mystic: 4, adept: 4, technomancer: 4 },
            B: { full: 3, aspected: 4, mystic: 3, adept: 3, technomancer: 3 },
            C: { full: 2, aspected: 3, mystic: 2, adept: 2, technomancer: 2 },
            D: { full: 1, aspected: 2, mystic: 1, adept: 1, technomancer: 1 },
            E: { full: 0, aspected: 0, mystic: 0, adept: 0, technomancer: 0 },
        },
        skills: {
            A: { skillPoints: 32 },
            B: { skillPoints: 24 },
            C: { skillPoints: 28 },
            D: { skillPoints: 16 },
            E: { skillPoints: 10 },
        },
        resources: {
            A: { nuyen: 450000 },
            B: { nuyen: 275000 },
            C: { nuyen: 150000 },
            D: { nuyen: 50000 },
            E: { nuyen: 8000 },
        }
    };

    function getMetatypeDisplay(priority) {
        const data = priorityData.metatype[priority]; 
        if (!data) return "No selection made.";
        const typesList = data.options.join(', ');
        return `Metatypes: ${typesList} (${data.adjustmentPoints})`;
        // Metatypes: Human, Elf, Ork, Dwarf, Troll (1)
    }

    function getAttributesDisplay(priority) {
        const data = priorityData.attributes[priority];
        if (!data) return "No selection made.";
        return `Attributes: ${data.points} attribute points`;
        // Attributes: 24 attribute points
    }

    function getResourcesDisplay(priority) {
        const data = priorityData.resources[priority];
        if (!data) return "No selection made.";
        return `Resources: Â¥${data.nuyen.toLocaleString()}`;
    }

    function getSkillsDisplay(priority) {
        const data = priorityData.skills[priority];
        if (!data) return "No selection made.";
        return `Skills: ${data.skillPoints} skill points`;
    }

    function getMagicDisplay(priority) {
        const data = priorityData.magic[priority];
        if (!data) return "No selection made.";

        const types = Object.entries(data)
            .map(([type, value]) => `${capitalize(type)} (${value})`)
            .join(', ');

        return `Magic/Resonance: ${types}`;
    }

    function capitalize(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Update the OUTPUT DIV
    function updateOutput() {
        const output = document.getElementById("output");

        const formatterFunctions = [
            getMetatypeDisplay,
            getAttributesDisplay,
            getSkillsDisplay,
            getMagicDisplay,
            getResourcesDisplay
        ];

        const lines = selectors.map((sel, index) => {
            const value = sel.value;
            const formatter = formatterFunctions[index];
            return formatter(value);
        })

        const html = `<strong>Selection Summary:</strong><br>${lines.join('<br>')}`;
        output.innerHTML = html;
        updateMetatypeOptions();
        updateMagicOptions();
    }

    // THEME and MODE FUNCTIONS
    // Function to toggle dark/light mode and save choice in local storage
    function toggleDarkMode()  {
        const body = document.body;
        const toggleButton = document.getElementById("theme-toggle");

        const isDark =  body.classList.toggle("dark-mode");
        toggleButton.textContent = isDark ? "Toggle Light Mode" : "Toggle Dark Mode";

        // Save preference
        localStorage.setItem("theme", isDark ? "dark" : "light");
    }

    function applySavedTheme() {
        const savedTheme = localStorage.getItem("theme");
        const toggleButton = document.getElementById("theme-toggle");

        if (savedTheme === "dark") {
            document.body.classList.add("dark-mode");
            toggleButton.textContent = "Toggle Light Mode";
        } else {
            toggleButton.textContent = "Toggle Dark Mode";
        }
    }

    updateDropdowns();
    applySavedTheme();

</script>

</body>
</html>
